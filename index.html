<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Present Simple: –§–æ–Ω–∞—Ä–∏–∫ –∏ –õ–∞–∑–µ—Ä—ã</title>
    <style>
        /* === –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò –ò –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï === */
        body {
            margin: 0; padding: 0; background-color: #0b0c10; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden; color: #fff; user-select: none;
        }

        #game-wrapper {
            position: relative; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
        }

        #game-container {
            width: 1280px; height: 720px;
            background: #1f2833;
            position: relative; transform-origin: center center;
            box-shadow: 0 0 30px #45a29e; border: 2px solid #66fcf1;
            border-radius: 15px; overflow: hidden;
        }

        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .screen.active { display: flex; }

        h1 { font-size: 60px; color: #66fcf1; margin-bottom: 20px; text-shadow: 0 0 10px #45a29e; text-align: center;}
        h2 { font-size: 40px; color: #c5c6c7; margin-bottom: 15px; z-index: 10; text-align: center;}

        /* –ö–Ω–æ–ø–∫–∏ */
        button {
            padding: 15px 35px; font-size: 26px; font-weight: bold; margin: 10px; cursor: pointer;
            border: 2px solid #66fcf1; border-radius: 10px; background: rgba(11, 12, 16, 0.8);
            color: #66fcf1; transition: 0.3s; box-shadow: 0 0 10px rgba(102, 252, 241, 0.2);
        }
        button:hover:not(:disabled) { background: #66fcf1; color: #0b0c10; box-shadow: 0 0 20px #66fcf1; }
        button:disabled { border-color: #555; color: #555; cursor: not-allowed; }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å UI */
        .top-bar {
            position: absolute; top: 15px; left: 20px; right: 20px;
            display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }
        .score-board { font-size: 28px; font-weight: bold; background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 10px; border: 1px solid #45a29e; }
        .controls { display: flex; align-items: center; gap: 15px; background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 10px; border: 1px solid #45a29e; }
        .controls input[type=range] { cursor: pointer; }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 200;
        }
        .modal-content {
            background: #c5c6c7; color: #0b0c10; padding: 40px; border-radius: 15px;
            text-align: center; max-width: 650px; border: 4px solid #45a29e;
        }
        .modal-content h3 { font-size: 34px; color: #d9534f; margin-top: 0; }
        .modal-content p { font-size: 24px; font-weight: bold; }

        /* –£–†–û–í–ï–ù–¨ 1: –§–û–ù–ê–†–ò–ö */
        #l1-words-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2;
        }
        .hidden-word {
            position: absolute; font-size: 45px; font-weight: bold; color: #66fcf1;
            cursor: pointer; padding: 20px; text-shadow: 0 0 15px #45a29e;
        }
        #l1-dark-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98); z-index: 3; pointer-events: none;
            transition: background 0.1s;
        }
        .l1-subject { position: absolute; bottom: 40px; width: 100%; text-align: center; font-size: 40px; font-weight: bold; z-index: 5; color: #fff;}
        .l1-hint { position: absolute; width: 100%; text-align: center; font-size: 22px; color: #4ade80; z-index: 5;}

        /* –£–†–û–í–ï–ù–¨ 2: –ó–í–ï–ó–î–û–ü–ê–î –ò –ü–£–®–ö–ê */
        #l2-sky { position: absolute; width: 100%; height: 100%; top: 0; left: 0; background: #0b0c10; z-index: 1;}
        
        /* 3D –ü–ª–∞–Ω–µ—Ç—ã —Å –≤—Ä–∞—â–∞—é—â–µ–π—Å—è —Ç–µ–∫—Å—Ç—É—Ä–æ–π */
        .l2-planet {
            position: absolute; top: 150px; 
            width: 220px; height: 220px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; text-align: center;
            font-size: 28px; font-weight: bold; color: #fff; text-shadow: 2px 2px 5px rgba(0,0,0,0.9);
            /* –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ç–µ–Ω—å —Å–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–º, –≤–Ω–µ—à–Ω—è—è —Ç–µ–Ω—å - –ª–µ–≥–∫–æ–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
            box-shadow: inset -25px -25px 40px rgba(0,0,0,0.8), 0 0 20px rgba(255,255,255,0.1);
            overflow: hidden; z-index: 2;
        }
        .l2-planet::before {
            content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            z-index: -1; animation: rotateBg 40s linear infinite;
        }
        @keyframes rotateBg { 100% { transform: rotate(360deg); } }

        /* –ì–∞–∑–æ–≤—ã–π –≥–∏–≥–∞–Ω—Ç (–ü–æ–ª–æ—Å–∞—Ç—ã–π) */
        .planet-0::before {
            background: repeating-linear-gradient(45deg, #d35400 0%, #e67e22 10%, #f39c12 20%, #d35400 30%);
        }
        /* –ü–ª–∞–Ω–µ—Ç–∞ –ó–µ–º–Ω–æ–≥–æ —Ç–∏–ø–∞ (–û–∫–µ–∞–Ω –∏ –º–∞—Ç–µ—Ä–∏–∫–∏) */
        .planet-1::before {
            background: radial-gradient(circle at 30% 40%, #2ecc71 20%, transparent 22%),
                        radial-gradient(circle at 70% 60%, #2ecc71 25%, transparent 27%),
                        radial-gradient(circle at 40% 80%, #2ecc71 15%, transparent 17%),
                        radial-gradient(circle at 80% 30%, #2ecc71 18%, transparent 20%),
                        #2980b9;
        }
        /* –ú–µ—Ä—Ç–≤–∞—è –ª—É–Ω–∞ (–°–µ—Ä—ã–µ –∫—Ä–∞—Ç–µ—Ä—ã) */
        .planet-2::before {
            background: radial-gradient(circle at 20% 30%, #7f8c8d 10%, transparent 12%),
                        radial-gradient(circle at 60% 70%, #7f8c8d 15%, transparent 17%),
                        radial-gradient(circle at 70% 20%, #7f8c8d 8%, transparent 10%),
                        radial-gradient(circle at 30% 80%, #7f8c8d 12%, transparent 14%),
                        #bdc3c7;
        }

        #l2-cannon {
            position: absolute; bottom: 20px; left: 600px; width: 80px; height: 100px;
            background: #45a29e; border-radius: 10px 10px 0 0; z-index: 5;
            box-shadow: inset 0 0 20px #0b0c10, 0 0 15px #66fcf1;
        }
        .l2-laser {
            position: absolute; display: none; background: #ff0055;
            width: 20px; height: 60px; border-radius: 10px; box-shadow: 0 0 15px #ff0055; z-index: 4;
        }

        /* –£–†–û–í–ï–ù–¨ 3: –°–ë–û–†–ö–ê –ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø */
        #l3-workspace { display: flex; flex-direction: column; align-items: center; width: 100%; z-index: 5;}
        #l3-sentence {
            display: flex; gap: 15px; margin-top: 60px; margin-bottom: 50px;
            min-height: 80px; padding: 20px; border-bottom: 3px dashed #45a29e; width: 800px; justify-content: center;
        }
        .l3-slot { font-size: 34px; font-weight: bold; color: #66fcf1; padding: 10px 20px; background: rgba(69, 162, 158, 0.2); border-radius: 10px; transition: 0.2s;}
        
        /* –ö–ª–∞—Å—Å –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ —Å–ª–æ—Ç–∞ –Ω–∞ 3 —É—Ä–æ–≤–Ω–µ (–¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å–ª–æ–≤–∞) */
        .l3-slot.filled { cursor: pointer; background: rgba(69, 162, 158, 0.6); border: 2px solid #66fcf1; color: #fff; }
        .l3-slot.filled:hover { background: #d9534f; border-color: #d9534f; transform: scale(0.95); }
        .l3-slot.filled:hover::after { content: " ‚ùå"; font-size: 20px; }

        #l3-pool { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; width: 800px;}
        .l3-word {
            font-size: 30px; padding: 15px 30px; background: #1f2833; border: 2px solid #66fcf1;
            border-radius: 15px; cursor: pointer; transition: 0.2s; color: #fff;
        }
        .l3-word:hover { background: #45a29e; transform: scale(1.1); }

        #secret-word-btn { display: none; background: #8e44ad; border-color: #9b59b6; }
    </style>
</head>
<body>

</script>

<audio id="bg-music" src="https://george-stone-pax.github.io/my-game-assets/Aylex%20-%20Back%20To%20Life%20(freetouse.com).mp3" loop></audio>
<audio id="snd-correct" src="https://george-stone-pax.github.io/my-game-assets/rightanswer-95219.mp3"></audio>
<audio id="snd-wrong" src="https://george-stone-pax.github.io/my-game-assets/dodgeball.mp3"></audio>

<div id="game-wrapper">
    <div id="game-container">
        
        <div class="top-bar">
            <div class="score-board">–ë–∞–ª–ª—ã: <span id="score-display">0</span></div>
            <div class="controls">
                <span style="font-size:20px;">üîä</span>
                <input type="range" id="vol" min="0" max="1" step="0.1" value="0.5">
                <button style="padding: 5px 15px; font-size: 18px; margin:0;" onclick="showHelp()">‚ùì –ö–∞–∫ –∏–≥—Ä–∞—Ç—å</button>
                <button style="padding: 5px 15px; font-size: 18px; margin:0;" onclick="toggleFullscreen()">‚õ∂</button>
            </div>
        </div>

        <div id="screen-menu" class="screen active">
            <h1>Present Simple</h1>
            <button onclick="switchScreen('screen-theory')">üìö –¢–µ–æ—Ä–∏—è</button>
            <button id="btn-start" disabled onclick="startLevel(1)">üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É üîí</button>
        </div>

        <div id="screen-theory" class="screen">
            <h2>–ü—Ä–∞–≤–∏–ª–∞ Present Simple</h2>
            <div style="background: rgba(0,0,0,0.6); padding: 30px; border-radius: 15px; max-width: 850px; text-align: left; font-size: 22px; border: 2px solid #45a29e; box-shadow: 0 0 20px rgba(69, 162, 158, 0.3);">
                <p style="margin-top: 0;"><span style="color: #4ade80; font-size: 28px;">‚úÖ</span> <b style="color: #4ade80;">–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:</b> –î–ª—è <i>I, you, we, they</i> –±–µ—Ä—ë–º –æ–±—ã—á–Ω—ã–π –≥–ª–∞–≥–æ–ª (<span style="color: #f1c40f;">I play</span>). –ê –≤–æ—Ç –¥–ª—è <i>He, she, it</i> –≥–ª–∞–≥–æ–ª –Ω–∞–¥–µ–≤–∞–µ—Ç —Ö–≤–æ—Å—Ç–∏–∫ <b>-s</b> (<span style="color: #f1c40f;">He plays</span>).</p>
                <p><span style="color: #ff0055; font-size: 28px;">‚ùå</span> <b style="color: #ff0055;">–û—Ç—Ä–∏—Ü–∞–Ω–∏—è:</b> –ù–∞ –ø–æ–º–æ—â—å –ø—Ä–∏—Ö–æ–¥—è—Ç <b style="color: #66fcf1;">don't</b> –∏–ª–∏ <b style="color: #66fcf1;">doesn't</b> (–¥–ª—è He/She/It). –ü–æ–º–Ω–∏: –æ–Ω–∏ ¬´—Å—ä–µ–¥–∞—é—Ç¬ª –æ–∫–æ–Ω—á–∞–Ω–∏–µ <b>-s</b> —É –≥–ª–∞–≤–Ω–æ–≥–æ –≥–ª–∞–≥–æ–ª–∞!</p>
                <p><span style="color: #f1c40f; font-size: 28px;">‚ùì</span> <b style="color: #f1c40f;">–í–æ–ø—Ä–æ—Å—ã:</b> –í —Å–∞–º–æ–µ –Ω–∞—á–∞–ª–æ –ø—Ä—ã–≥–∞—é—Ç <b style="color: #66fcf1;">Do</b> –∏–ª–∏ <b style="color: #66fcf1;">Does</b>. –û–∫–æ–Ω—á–∞–Ω–∏–µ <b>-s</b> —É –≥–ª–∞–≥–æ–ª–∞ —Ç–æ–∂–µ –ø—Ä–æ–ø–∞–¥–∞–µ—Ç.</p>
                <div style="background: rgba(69, 162, 158, 0.2); padding: 15px; border-radius: 10px; margin-top: 20px; border-left: 5px solid #66fcf1;">
                    <p style="margin: 0; font-size: 20px;"><b>–ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ –≤ –≤–æ–ø—Ä–æ—Å–µ:</b></p>
                    <p style="margin: 10px 0 0 0; text-align: center; font-size: 24px; text-shadow: 0 0 10px rgba(0,0,0,0.8);">
                        <span style="color: #66fcf1;">Do/Does</span> ‚ûï <span style="color: #f1c40f;">–ö—Ç–æ/–ß—Ç–æ?</span> ‚ûï <span style="color: #fff;">–î–µ–π—Å—Ç–≤–∏–µ</span> ‚ûï <span style="color: #a0aec0;">–û—Å—Ç–∞–ª—å–Ω–æ–µ</span> ‚ûï <span style="color: #66fcf1;">?</span>
                    </p>
                </div>
            </div>
            <button onclick="unlockGame()" style="margin-top: 30px;">–í—Å—ë –ø–æ–Ω—è—Ç–Ω–æ, –≤ –±–æ–π!</button>
        </div>

        <div id="screen-level1" class="screen">
            <h2 style="position: absolute; top: 20px; z-index: 10;">–£—Ä–æ–≤–µ–Ω—å 1: –ü–æ–∏—Å–∫ –≤ —Ç–µ–º–Ω–æ—Ç–µ</h2>
            <div class="l1-hint" style="top: 120px;">–£–¥–µ—Ä–∂–∏–≤–∞–π –ü–†–ê–í–£–Æ –∫–Ω–æ–ø–∫—É –º—ã—à–∏, —á—Ç–æ–±—ã —Å–≤–µ—Ç–∏—Ç—å —Ñ–æ–Ω–∞—Ä–∏–∫–æ–º!</div>
            <div id="l1-words-container"></div>
            <div id="l1-dark-overlay"></div>
            <div class="l1-subject" id="l1-subject"></div>
        </div>

        <div id="screen-level2" class="screen">
            <h2 style="position: absolute; top: 50px; z-index: 10;">–£—Ä–æ–≤–µ–Ω—å 2: –õ–∞–∑–µ—Ä–Ω–∞—è –ø—É—à–∫–∞ (–û—Ç—Ä–∏—Ü–∞–Ω–∏—è)</h2>
            <div class="l1-subject" id="l2-subject" style="bottom: 150px;"></div>
            <div id="l2-sky">
                <div id="l2-stars-container"></div>
                <div id="l2-cannon"></div>
                <div class="l2-laser" id="l2-laser"></div>
            </div>
        </div>

        <div id="screen-level3" class="screen">
            <h2 style="position: absolute; top: 20px; z-index: 10;">–£—Ä–æ–≤–µ–Ω—å 3: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤</h2>
            <div id="l3-workspace">
                <div id="l3-sentence"></div>
                <div id="l3-pool"></div>
            </div>
        </div>

        <div id="screen-end" class="screen">
            <h1>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h1>
            <h2>–û—Ü–µ–Ω–∫–∞: <span id="final-grade" style="color: #f1c40f; font-size: 80px;"></span></h2>
            <p style="font-size: 30px;">–ù–∞–±—Ä–∞–Ω–æ –±–∞–ª–ª–æ–≤: <span id="final-score">0</span> –∏–∑ 24.</p>
            <div>
                <button onclick="showModal('modal-criteria')">–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏</button>
                <button id="secret-word-btn" onclick="showModal('modal-secret')">üóùÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –°–ï–ö–†–ï–¢–ù–û–ï –°–õ–û–í–û</button>
                <button onclick="location.reload()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            </div>
        </div>

        <div id="modal-error" class="modal-overlay">
            <div class="modal-content">
                <h3>–û—à–∏–±–∫–∞! ‚ùå</h3>
                <p id="error-text"></p>
                <!-- –®—Ç—Ä–∞—Ñ —É–±—Ä–∞–Ω -->
                <button style="margin-top: 20px;" onclick="closeError()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>
        </div>

        <div id="modal-criteria" class="modal-overlay">
            <div class="modal-content">
                <h3>–ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏</h3>
                <p style="text-align: left; font-size: 20px;">
                    ¬´5¬ª: 21‚Äì24 –±–∞–ª–ª–æ–≤ (85-100%)<br>
                    ¬´4¬ª: 17‚Äì20 –±–∞–ª–ª–æ–≤ (70-84%)<br>
                    ¬´3¬ª: 12‚Äì16 –±–∞–ª–ª–æ–≤ (50-69%)<br>
                    ¬´2¬ª: 0‚Äì11 –±–∞–ª–ª–æ–≤ (–º–µ–Ω–µ–µ 50%)
                </p>
                <button onclick="closeModal('modal-criteria')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <div id="modal-secret" class="modal-overlay">
            <div class="modal-content">
                <h3>–ù–∞–≥—Ä–∞–¥–∞! üèÜ</h3>
                <p style="font-size: 50px; color: #8e44ad; margin: 10px 0;">Sofa - –î–∏–≤–∞–Ω</p>
                <button onclick="closeModal('modal-secret')">–°—É–ø–µ—Ä!</button>
            </div>
        </div>

        <div id="modal-help" class="modal-overlay">
            <div class="modal-content">
                <h3>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å?</h3>
                <p id="help-text"></p>
                <button onclick="closeModal('modal-help')">–í –±–æ–π!</button>
            </div>
        </div>

    </div>
</div>

<script>
    // --- –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï ---
    const wrapper = document.getElementById('game-wrapper');
    const container = document.getElementById('game-container');
    function resizeGame() {
        const scale = Math.min(wrapper.clientWidth / 1280, wrapper.clientHeight / 720);
        container.style.transform = `scale(${scale})`;
    }
    window.addEventListener('resize', resizeGame); resizeGame();

    function toggleFullscreen() {
        if (!document.fullscreenElement) document.documentElement.requestFullscreen().catch(()=>{});
        else document.exitFullscreen();
    }

    // –ë–õ–û–ö–ò–†–û–í–ö–ê –°–ö–†–û–õ–õ–ê –ò –ö–û–ù–¢–ï–ö–°–¢–ù–û–ì–û –ú–ï–ù–Æ –ë–†–ê–£–ó–ï–†–ê
    window.addEventListener('keydown', e => {
        if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space"].includes(e.code)) e.preventDefault();
    });
    container.addEventListener('contextmenu', e => e.preventDefault());

    // --- –ó–í–£–ö –ò –ì–†–û–ú–ö–û–°–¢–¨ ---
    const bgMusic = document.getElementById('bg-music');
    const sfxCorrect = document.getElementById('snd-correct');
    const sfxWrong = document.getElementById('snd-wrong');
    document.getElementById('vol').addEventListener('input', e => {
        let v = e.target.value; bgMusic.volume = v; sfxCorrect.volume = v; sfxWrong.volume = v;
    });

    function playSfx(type) {
        let s = type === 'correct' ? sfxCorrect : sfxWrong;
        s.currentTime = 0; s.play();
    }

    // --- –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê ---
    let score = 0;
    let currentLevel = 0;
    let questionIndex = 0;
    let isPaused = false;
    let animationFrameId;

    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
    function showModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function unlockGame() {
        document.getElementById('btn-start').disabled = false;
        document.getElementById('btn-start').innerText = "üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É";
        switchScreen('screen-menu'); bgMusic.play().catch(()=>{});
    }

    function updateScore() { document.getElementById('score-display').innerText = score; }

    function showError(text, callback) {
        isPaused = true; playSfx('wrong');
        // –®—Ç—Ä–∞—Ñ –∑–∞ –æ—à–∏–±–∫—É —É–±—Ä–∞–Ω, –∏–≥—Ä–æ–∫ –ø—Ä–æ—Å—Ç–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç +1 –±–∞–ª–ª
        document.getElementById('error-text').innerHTML = text;
        showModal('modal-error');
        window.errorCallback = callback;
    }
    function closeError() {
        closeModal('modal-error'); isPaused = false;
        if(window.errorCallback) { let cb = window.errorCallback; window.errorCallback = null; cb(); }
    }

    function showHelp() {
        let txt = "";
        if(currentLevel === 1) txt = "–£–¥–µ—Ä–∂–∏–≤–∞–π –ü–†–ê–í–£–Æ –∫–Ω–æ–ø–∫—É –º—ã—à–∏, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –≥–æ–ª—É–±–æ–π —Ñ–æ–Ω–∞—Ä–∏–∫ –∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–º–Ω–æ—Ç—É. –ù–∞—à–µ–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ? –ö–ª–∏–∫–∞–π –ø–æ –Ω–µ–º—É –õ–ï–í–û–ô –∫–Ω–æ–ø–∫–æ–π, –ø–æ–∫–∞ –¥–µ—Ä–∂–∏—à—å —Ñ–æ–Ω–∞—Ä–∏–∫!";
        if(currentLevel === 2) txt = "–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–µ–ª–æ—á–∫–∏ ‚¨ÖÔ∏è –∏ ‚û°Ô∏è –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è –ø—É—à–∫–∏. –ù–∞–∂–º–∏ –ü–†–û–ë–ï–õ, —á—Ç–æ–±—ã –≤—ã—Å—Ç—Ä–µ–ª–∏—Ç—å –ª–∞–∑–µ—Ä–æ–º –≤ –ø–ª–∞–Ω–µ—Ç—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ—Ç–≤–µ—Ç–æ–º.";
        if(currentLevel === 3) txt = "–ö–ª–∏–∫–∞–π –ø–æ —Å–ª–æ–≤–∞–º –≤–Ω–∏–∑—É, —á—Ç–æ–±—ã –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏—Ö –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ. –ï—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–ª ‚Äî –∫–ª–∏–∫–Ω–∏ –Ω–∞ —Å–ª–æ–≤–æ –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏, –∏ –æ–Ω–æ –≤–µ—Ä–Ω–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ. –û—à–∏–±–∫–∞ –∑–∞—Å—á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –ø—Ä–æ–ø—É—Å–∫–∏!";
        document.getElementById('help-text').innerText = txt;
        showModal('modal-help');
    }

    function startLevel(lvl) {
        cancelAnimationFrame(animationFrameId);
        currentLevel = lvl; questionIndex = 0; isPaused = false;
        switchScreen(`screen-level${lvl}`);
        showHelp();
        if(lvl === 1) initLevel1();
        else if(lvl === 2) initLevel2();
        else if(lvl === 3) initLevel3();
    }

    // --- –£–†–û–í–ï–ù–¨ 1: –§–û–ù–ê–†–ò–ö (8 –ó–∞–¥–∞–Ω–∏–π) ---
    const l1Data = [
        { sub: "The boy (he) ___", correct: "reads", wrong: ["read", "raeds", "reeds"], rule: "–° 'he' –≥–ª–∞–≥–æ–ª —Ç—Ä–µ–±—É–µ—Ç -s!" },
        { sub: "I ___ apples", correct: "like", wrong: ["likes", "liek", "laike"], rule: "–° 'I' –æ–∫–æ–Ω—á–∞–Ω–∏–µ -s –Ω–µ –Ω—É–∂–Ω–æ!" },
        { sub: "The cat (it) ___", correct: "jumps", wrong: ["jump", "jumes", "jumpps"], rule: "–° 'it' (–∫–æ—Ç) –≥–ª–∞–≥–æ–ª –ø–æ–ª—É—á–∞–µ—Ç -s!" },
        { sub: "We ___ books", correct: "read", wrong: ["reads", "raed", "reds"], rule: "–° 'We' –æ–∫–æ–Ω—á–∞–Ω–∏–µ –Ω–µ –Ω—É–∂–Ω–æ!" },
        { sub: "The girl (she) ___", correct: "runs", wrong: ["run", "runes", "rns"], rule: "–° 'she' –≥–ª–∞–≥–æ–ª —Ç—Ä–µ–±—É–µ—Ç -s!" },
        { sub: "They ___ tennis", correct: "play", wrong: ["plays", "plaies", "pley"], rule: "–° 'They' –æ–∫–æ–Ω—á–∞–Ω–∏–µ -s –Ω–µ –Ω—É–∂–Ω–æ!" },
        { sub: "My brother (he) ___", correct: "sleeps", wrong: ["sleep", "sleeppes", "sleps"], rule: "–° 'he' –≥–ª–∞–≥–æ–ª —Ç—Ä–µ–±—É–µ—Ç -s!" },
        { sub: "You ___ English", correct: "study", wrong: ["studies", "studi", "studys"], rule: "–° 'You' –æ–∫–æ–Ω—á–∞–Ω–∏–µ -s –Ω–µ –Ω—É–∂–Ω–æ!" }
    ];

    let isRightMouseDown = false;
    
    container.addEventListener('mousedown', e => {
        if(e.button === 2 && currentLevel === 1) { 
            isRightMouseDown = true; updateFlashlight(e); 
        }
    });
    window.addEventListener('mouseup', e => {
        if(e.button === 2 && currentLevel === 1) { 
            isRightMouseDown = false; updateFlashlight(e); 
        }
    });
    container.addEventListener('mousemove', e => {
        if(isRightMouseDown && currentLevel === 1) updateFlashlight(e);
    });

    function updateFlashlight(e) {
        const overlay = document.getElementById('l1-dark-overlay');
        if(isRightMouseDown) {
            const rect = container.getBoundingClientRect();
            const scale = rect.width / 1280;
            let x = (e.clientX - rect.left) / scale;
            let y = (e.clientY - rect.top) / scale;
            overlay.style.background = `radial-gradient(circle 180px at ${x}px ${y}px, rgba(0, 195, 255, 0.1) 0%, rgba(0,0,0,0.98) 70%)`;
        } else {
            overlay.style.background = `rgba(0,0,0,0.98)`;
        }
    }

    function initLevel1() {
        if(questionIndex >= 8) { setTimeout(()=>startLevel(2), 1000); return; }
        let q = l1Data[questionIndex];
        document.getElementById('l1-subject').innerText = q.sub;
        
        const canvas = document.getElementById('l1-words-container');
        canvas.innerHTML = '';
        
        let words = [q.correct, ...q.wrong].sort(() => Math.random() - 0.5);
        words.forEach((word, i) => {
            let el = document.createElement('div');
            el.className = 'hidden-word'; el.innerText = word;
            
            let rx = 50 + i * 280 + Math.random() * 80;
            let ry = 200 + Math.random() * 300;
            
            el.style.left = rx + 'px'; el.style.top = ry + 'px';
            
            el.onclick = () => {
                if(isPaused || !isRightMouseDown) return; 
                
                isRightMouseDown = false;
                updateFlashlight(null);

                if(word === q.correct) {
                    playSfx('correct'); score++; updateScore(); questionIndex++; initLevel1();
                } else {
                    showError(q.rule + "<br><br>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: <b>" + q.correct + "</b>", () => {
                        questionIndex++; initLevel1();
                    });
                }
            };
            canvas.appendChild(el);
        });
    }

    // --- –£–†–û–í–ï–ù–¨ 2: –ü–£–®–ö–ê (8 –ó–∞–¥–∞–Ω–∏–π) ---
    const l2Data = [
        { sub: "The dogs (they)", correct: "don't", wrong: ["doesn't", "dno't"], rule: "–°–æ–±–∞–∫–∏ (They) –∏—Å–ø–æ–ª—å–∑—É—é—Ç don't." },
        { sub: "The doctor (he)", correct: "doesn't", wrong: ["don't", "deson't"], rule: "–î–æ–∫—Ç–æ—Ä (He) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç doesn't." },
        { sub: "You", correct: "don't", wrong: ["doesn't", "dnot"], rule: "–° 'You' –∏—Å–ø–æ–ª—å–∑—É–µ–º don't." },
        { sub: "My sister (she)", correct: "doesn't", wrong: ["don't", "dsone't"], rule: "–°–µ—Å—Ç—Ä–∞ (She) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç doesn't." },
        { sub: "My friends (they)", correct: "don't", wrong: ["doesn't", "dont'"], rule: "–î—Ä—É–∑—å—è (They) –∏—Å–ø–æ–ª—å–∑—É—é—Ç don't." },
        { sub: "I", correct: "don't", wrong: ["doesn't", "donet"], rule: "–° 'I' –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º don't." },
        { sub: "The sun (it)", correct: "doesn't", wrong: ["don't", "dsoent"], rule: "–°–æ–ª–Ω—Ü–µ (It) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç doesn't." },
        { sub: "We", correct: "don't", wrong: ["doesn't", "dnot"], rule: "–° 'We' –∏—Å–ø–æ–ª—å–∑—É–µ–º don't." }
    ];

    let l2PlayerX = 600;
    let l2Keys = { ArrowLeft: false, ArrowRight: false, Space: false };
    let bullet = { active: false, x: 0, y: 0 };
    let starsData = [];

    window.addEventListener('keydown', e => { if(e.code in l2Keys) l2Keys[e.code] = true; });
    window.addEventListener('keyup', e => { if(e.code in l2Keys) l2Keys[e.code] = false; });

    function initLevel2() {
        if(questionIndex >= 8) { cancelAnimationFrame(animationFrameId); setTimeout(()=>startLevel(3), 1000); return; }
        
        bullet.active = false; document.getElementById('l2-laser').style.display = 'none';
        document.getElementById('l2-subject').innerText = l2Data[questionIndex].sub;
        
        const container = document.getElementById('l2-stars-container');
        container.innerHTML = ''; starsData = [];
        
        let q = l2Data[questionIndex];
        let words = [q.correct, q.wrong[0], q.wrong[1]].sort(()=>Math.random() - 0.5);
        
        let positions = [150, 530, 910];
        let planetClasses = ['planet-0', 'planet-1', 'planet-2'].sort(()=>Math.random() - 0.5);
        
        words.forEach((w, i) => {
            let el = document.createElement('div');
            el.className = 'l2-planet ' + planetClasses[i];
            el.innerText = w;
            el.style.left = positions[i] + 'px';
            container.appendChild(el);
            starsData.push({ el: el, text: w, x: positions[i], y: 150, width: 220, height: 220 });
        });
        
        cancelAnimationFrame(animationFrameId);
        loopL2();
    }

    function loopL2() {
        if(currentLevel !== 2 || isPaused) { animationFrameId = requestAnimationFrame(loopL2); return; }
        
        if(l2Keys.ArrowLeft) l2PlayerX -= 10;
        if(l2Keys.ArrowRight) l2PlayerX += 10;
        if(l2PlayerX < 0) l2PlayerX = 0;
        if(l2PlayerX > 1200) l2PlayerX = 1200;
        document.getElementById('l2-cannon').style.left = l2PlayerX + 'px';

        if(l2Keys.Space && !bullet.active) {
            bullet.active = true;
            bullet.x = l2PlayerX + 30;
            bullet.y = 580;
            let bEl = document.getElementById('l2-laser');
            bEl.style.display = 'block'; bEl.style.left = bullet.x + 'px';
        }

        if(bullet.active) {
            bullet.y -= 7; 
            let bEl = document.getElementById('l2-laser');
            bEl.style.top = bullet.y + 'px';

            starsData.forEach(star => {
                if (bullet.x < star.x + star.width && bullet.x + 20 > star.x &&
                    bullet.y < star.y + star.height && bullet.y + 60 > star.y) {
                    
                    bullet.active = false; bEl.style.display = 'none';
                    checkL2Shoot(star.text, l2Data[questionIndex]);
                }
            });

            if(bullet.y < 0) { bullet.active = false; bEl.style.display = 'none'; }
        }

        animationFrameId = requestAnimationFrame(loopL2);
    }

    function checkL2Shoot(shotText, q) {
        if(shotText === q.correct) {
            playSfx('correct'); score++; updateScore(); questionIndex++;
            setTimeout(initLevel2, 500);
        } else {
            let msg = `–¢—ã –ø–æ–¥–±–∏–ª –Ω–µ —Ç—É –ø–ª–∞–Ω–µ—Ç—É: ${shotText}. `;
            if(q.wrong.includes(shotText) && shotText.length === q.correct.length && shotText !== q.wrong[0]) {
                msg = `–≠—Ç–æ –ø–ª–∞–Ω–µ—Ç–∞-–æ–±–º–∞–Ω–∫–∞ —Å –ø–µ—Ä–µ–ø—É—Ç–∞–Ω–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏: ${shotText}. `;
            }
            showError(msg + "<br>" + q.rule + "<br>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: <b>" + q.correct + "</b>", () => {
                questionIndex++; initLevel2();
            });
        }
    }

    // --- –£–†–û–í–ï–ù–¨ 3: –ö–û–ù–°–¢–†–£–ö–¢–û–† –ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø (8 –ó–∞–¥–∞–Ω–∏–π) ---
    const l3Data = [
        { q: "Does he play chess ?", words: ["he", "play", "Does", "chess", "?"], rule: "–î–ª—è –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è <b>he</b> –≤ –≤–æ–ø—Ä–æ—Å–µ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º <b>Does</b>." },
        { q: "Do they like pizza ?", words: ["like", "?", "they", "Do", "pizza"], rule: "–î–ª—è –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è <b>they</b> –≤ –≤–æ–ø—Ä–æ—Å–µ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º <b>Do</b>." },
        { q: "Does she read books ?", words: ["books", "she", "?", "read", "Does"], rule: "–î–ª—è –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è <b>she</b> –≤ –≤–æ–ø—Ä–æ—Å–µ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º <b>Does</b>." },
        { q: "Do we go home ?", words: ["home", "we", "Do", "?", "go"], rule: "–î–ª—è –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è <b>we</b> –≤ –≤–æ–ø—Ä–æ—Å–µ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º <b>Do</b>." },
        { q: "Does it fly high ?", words: ["high", "fly", "Does", "?", "it"], rule: "–î–ª—è –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è <b>it</b> –≤ –≤–æ–ø—Ä–æ—Å–µ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º <b>Does</b>." },
        { q: "Do you drink tea ?", words: ["drink", "you", "Do", "?", "tea"], rule: "–î–ª—è –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è <b>you</b> –≤ –≤–æ–ø—Ä–æ—Å–µ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º <b>Do</b>." },
        { q: "Does John eat meat ?", words: ["meat", "John", "eat", "Does", "?"], rule: "John ‚Äî —ç—Ç–æ –æ–Ω (he), –ø–æ—ç—Ç–æ–º—É –≤ –≤–æ–ø—Ä–æ—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º <b>Does</b>." },
        { q: "Do cats catch mice ?", words: ["cats", "?", "Do", "mice", "catch"], rule: "Cats ‚Äî —ç—Ç–æ –æ–Ω–∏ (they), –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º <b>Do</b>." }
    ];

    let l3Target = [];
    let l3Current = [];

    function initLevel3() {
        if(questionIndex >= 8) { finishGame(); return; }
        let currentQ = l3Data[questionIndex];
        l3Target = currentQ.q.split(" ");
        l3Current = [];
        renderL3();
    }

    function renderL3() {
        let sentContainer = document.getElementById('l3-sentence');
        let poolContainer = document.getElementById('l3-pool');
        sentContainer.innerHTML = ''; poolContainer.innerHTML = '';

        for(let i=0; i<l3Target.length; i++) {
            let slot = document.createElement('div');
            slot.className = 'l3-slot';
            
            if(l3Current[i]) {
                slot.classList.add('filled');
                slot.innerText = l3Current[i];
                slot.onclick = () => {
                    if(isPaused) return;
                    l3Current.splice(i, 1);
                    renderL3();
                };
            } else {
                slot.innerText = "___";
            }
            sentContainer.appendChild(slot);
        }

        let availableWords = [...l3Data[questionIndex].words];
        l3Current.forEach(w => {
            let idx = availableWords.indexOf(w);
            if(idx > -1) availableWords.splice(idx, 1);
        });

        availableWords.forEach(w => {
            let btn = document.createElement('div');
            btn.className = 'l3-word'; btn.innerText = w;
            btn.onclick = () => {
                if(isPaused) return;
                if(l3Current.length < l3Target.length) {
                    l3Current.push(w);
                    renderL3();
                    checkL3Completion();
                }
            };
            poolContainer.appendChild(btn);
        });
    }

    function checkL3Completion() {
        if(l3Current.length === l3Target.length) {
            let expected = l3Target.join(" ");
            let actual = l3Current.join(" ");
            
            if(actual === expected) {
                playSfx('correct'); score++; updateScore(); questionIndex++;
                setTimeout(initLevel3, 1000);
            } else {
                let currentQ = l3Data[questionIndex];
                let errorMsg = `
                    <div style="font-size:22px; line-height: 1.6;">
                        <p style="margin: 0;">–í–∞—à –æ—Ç–≤–µ—Ç:</p>
                        <p style="color:#d9534f; font-weight:bold; margin-top: 5px;">${actual}</p>
                        
                        <p style="margin: 0; margin-top: 15px;">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</p>
                        <p style="color:#4ade80; font-weight:bold; margin-top: 5px;">${expected}</p>
                        
                        <hr style="border-color:#45a29e; margin: 20px 0;">
                        
                        <p style="text-align:left; font-size: 20px;">
                            <b>–§–æ—Ä–º—É–ª–∞ –≤–æ–ø—Ä–æ—Å–∞:</b><br> 
                            <span style="color:#66fcf1">Do / Does</span> + <span style="color:#f1c40f">–ö—Ç–æ/–ß—Ç–æ</span> + <span style="color:#fff">–î–µ–π—Å—Ç–≤–∏–µ</span> + –æ—Å—Ç–∞–ª—å–Ω–æ–µ + <span style="color:#66fcf1">?</span>
                        </p>
                        <p style="text-align:left; font-size: 20px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px;">
                            üí° ${currentQ.rule}
                        </p>
                    </div>
                `;
                
                showError(errorMsg, () => {
                    questionIndex++; // –ò–¥–µ–º –¥–∞–ª—å—à–µ, –Ω–æ –±–∞–ª–ª –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è
                    initLevel3();
                });
            }
        }
    }

    // --- –§–ò–ù–ê–õ ---
    function finishGame() {
        switchScreen('screen-end');
        document.getElementById('final-score').innerText = score;
        
        let grade = "2";
        if(score >= 21) grade = "5";
        else if(score >= 17) grade = "4";
        else if(score >= 12) grade = "3";
        
        document.getElementById('final-grade').innerText = grade;
        if(grade === "5") document.getElementById('secret-word-btn').style.display = 'inline-block';
    }
</script>
</body>
</html>

